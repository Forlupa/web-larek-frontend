# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения


### Об архитектуре 

Взаимодействия внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычислениями между этой передачей, и еще они меняют значения в моделях.


Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:
- `constructor(baseUrl: string, options: RequestInit = {})` - принимает базовый адрес сервера и опциональный объект с заголовками запросов.

Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `handleResponse` - асинхронный метод, обрабатывающий ответ от сервера

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `off` - отписка от события
- `emit` - инициализация события
- `onAll` - подписка на все события
- `offAll` - отписка от всех событий
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс Model 
Абстрактный класс, необходимый для того чтобы отличить компоненты от простых объектов.

Конструктор:
- `constructor(data: Partial<T>, protected events: IEvents)` - принимает компонент для отслеживания и EventEmitter.

Класс имеет такие методы:
- `emitChanges` - сообщает об измнениях 


#### Класс AppState 
Класс отвечает за хранение и логику работы с данными приложения.\
В полях класса хранятся следующие данные:
-  `basket: ICard[]` - корзина с товарами
-  `cards: ICard[]` - массив товаров
-  `order: IOrder` - информация о заказе
-  `formErrors: FormErrors` - ошибки формы

Так же класс предоставляет набор методов для взаимодействия с этими данными:
-  `addToBasket` - добавляет товар в корзину
-  `deleteFromBasket` - удаляет товар из корзины
-  `clearBasket` - очищает корзину целиком
-  `getBasketLength` - возвращяет количество товаров в корзине
-  `getTotalPrice` - возвращает общую стоимость товаров в корзине
-  `setOrderForm` - заполняет поля формы
-  `checkOrderValidation` - валидирует форму заказа
-  `checkContactsValidation` - валидирует форму контактов
-  `clearOrder` - сбрасывает заказ после покупки

### Слой представления

#### Класс Component

Абстрактный класс, отвечающий за управление отображением всех компонентов страницы. Является дженериком и принимает тип данных компонентов

Конструктор: 
- `constructor(protected readonly container: HTMLElement)` - принимает родительский элемент.

Класс предоставляет набор методов:
  - `toggleClass` - переключает класс

  - `setText` - устанавливает текстовое содержимое 

  - `setImage` - устанавливает изображение 

  - `render` - заполненет свойства элемента и возвращает его в формате HTMLElement.

#### Класс Page 
Класс, описывающий главную страницу. Наследуется от абстрактного класса Component.

Конструктор:
- `constructor(container: HTMLElement, protected events: IEvents)` - принимает родительский элемент и обработчик событий.

В полях класса хранятся ссылки на внутренние элементы.\
Класс имеет такие свойства и методы:
- `counter` - сеттер счетчика товаров в корзине
- `cards` - сеттер каталога товаров
- `locked` - сеттер блокировки прокрутки страницы

#### Класс Card 
Класс, описывающий карточку товара. Наследуется от абстрактного класса Component.

Конструктор: 
- `constructor(protected blockName: string, container: HTMLElement, actions?: ICardActions)` - принимает имя блока, родительский контейнер и объект с колбэк функциями

В полях класса хранятся ссылки на внутренние элементы.\
Класс имеет такие свойства и методы:
- `id` - сеттер и геттер для уникального идентификатора товара
- `title` - сеттер и геттер для названия товара
- `description` - сеттер описания товара
- `image` - сеттер картинки товара
- `category` - сеттер категории товара
- `price` - сеттер цены товара

#### Класс Basket
Класс, описывающий корзину товаров. Наследуется от абстрактного класса Component.

Конструктор: 
- `constructor(protected blockName: string, container: HTMLElement, protected events: IEvents)` - принимает имя блока, родительский элемент и обработчик событий

В полях класса хранятся ссылки на внутренние элементы.\
Класс имеет такие свойства и методы:
- `list` - сеттер списка товаров 
- `totalPrice` - сеттер общей цены
- `disableButton` - метод отключающий кнопку "Оформить"

#### Класс Form
Абстрактный класс, описывающий форму. Наследуется от абстрактного класса Component.

Конструктор: 
- `constructor(protected container: HTMLFormElement, protected events: IEvents)` - принимает элемент формы и обработчик событий

В полях класса хранятся ссылки на внутренние элементы.\
Класс имеет такие свойства и методы:
- `errors` - ошибки валидации формы
- `isvalid` - ограничивает доступ к кнопке при ошибках валидации
- `onInputChange` - реагирует на изменения в инпутах
- `render` - отображает форму

#### Класс FormOrder
Класс, описывающий окно заказа. Наследуется от абстрактного класса Form.

Конструктор: 
- `constructor(protected blockName: string, container: HTMLFormElement, protected events: IEvents)` - принимает имя блока, родительский контейнер и обработчик событий

В полях класса хранятся ссылки на внутренние элементы.

#### Класс FormContacts
Класс, описывающий окно контактов. Наследуется от абстрактного класса Form.

Конструктор: 
- `constructor(container: HTMLFormElement, events: IEvents)` - принимает родительский элемент и обработчик событий.

#### Класс Modal
Класс, выполняющий функцию отображения модального окна. Наследуется от абстрактного класса Component.

Конструктор: 
- `constructor(container: HTMLElement, protected events: IEvents)` - принимает родительский элемент и обработчик событий

В полях класса хранятся ссылки на внутренние элементы.\
Класс имеет такие свойства и методы:
- `content` - сеттер контента который будет отображаться в модальном окне
- `open` - открывает модальное окно
- `close` - закрывает модальное окно
- `render` - отображает модальное окно 

#### Класс Succsess
Класс, описывающий окно с результатом оформления заказа. Наследуется от абстрактного класса Component.

Конструктор: 
- `constructor(protected blockName: string, container: HTMLElement, actions?: ISuccessActions)` - принимает имя блока, родительский контейнер и объект с колбэк функциями

В полях класса хранятся ссылки на внутренние элементы.\
Класс имеет такие методы:
- `description` - сеттер для надписи о том, сколько синапсов было списано со счета

### Слой коммуникации



### Данные и типы данных используемые в приложении

Тип для всех возможных категорий

```
export type CategoryType =
   'софт-скил'
  | 'другое'
  | 'дополнительное'
  | 'кнопка'
  | 'хард-скил';
```

Интерфейс карточки товара

```
export interface ICard {
  id: string;
  description: string;
  image: string;
  title: string;
  category: CategoryType;
  price: number | null;
}
```

Интерфейс заказа

```
export interface IOrder {
  payment: string;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

Интерфейс данных приложения

```
export interface IStoreData {
  basket: ICard[];
  cards: ICard[];
  order: IOrder;
  formErrors: FormErrors;
  addToBasket(card: ICard): void;
  deleteFromBasket(cardId: string): void;
  clearBasket(): void;
  getBasketLength(): number;
  getTotalPrice(): number;
  setOrderForm(field: keyof TOrderInfo, value: string): void;
  checkOrderValidation(data: Record<keyof TOrderForm, string>): boolean;
  checkContactsValidation(data: Record<keyof TContactsForm, string>): boolean;
  clearOrder(): boolean;
}
```

Тип для формы заказа

```
export type TOrderForm = Pick<IOrder, "payment" | "email" | "phone" | "address">
```